
<?php

function jsIncludes() {
    ?>
    <!-- dhtmlxWindows -->

    <link rel="stylesheet" type="text/css" href="../../include/dhtmlxWindows/codebase/dhtmlxwindows.css">
    <link rel="stylesheet" type="text/css" href="../../include/dhtmlxWindows/codebase/skins/dhtmlxwindows_dhx_skyblue.css">
    <!--<script src='../../include/dhtmlxGrid/codebase/dhtmlxcommon_debug.js'></script>-->
    <script src="../../include/dhtmlxWindows/codebase/dhtmlxcommon.js"></script>
    <script src="../../include/dhtmlxWindows/codebase/dhtmlxwindows.js"></script>

    <!-- Display menus-->
    <link rel="stylesheet" type="text/css" href="../../include/dhtmlxMenu/codebase/skins/dhtmlxmenu_dhx_skyblue.css">
    <link rel="stylesheet" type="text/css" href="../../include/dhtmlxMenu/codebase/skins/dhtmlxmenu_dhx_blue.css">
    <link rel="stylesheet" type="text/css" href="../../include/dhtmlxMenu/codebase/skins/dhtmlxmenu_glassy_blue.css">
    <script  src="../../include/dhtmlxMenu/codebase/dhtmlxcommon.js"></script>
    <script  src="../../include/dhtmlxMenu/codebase/dhtmlxmenu.js"></script>

    <!-- dhtmlxGrid -->
    <link rel='STYLESHEET' type='text/css' href='../../include/dhtmlxGrid/codebase/dhtmlxgrid.css'>

    <script src='../../include/dhtmlxGrid/codebase/dhtmlxgrid.js'></script>
    <script src='../../include/dhtmlxGrid/codebase/ext/dhtmlxgrid_form.js'></script>
    <script src='../../include/dhtmlxGrid/codebase/ext/dhtmlxgrid_filter.js'></script>
    <script src='../../include/dhtmlxGrid/codebase/ext/dhtmlxgrid_srnd.js'></script>
    <script src='../../include/dhtmlxGrid/codebase/dhtmlxgridcell.js'></script>
    <script  src="../../include/dhtmlxGrid/codebase/ext/dhtmlxgrid_drag.js"></script>

    <script src="../../include/dhtmlxWindows/codebase/dhtmlxcontainer.js"></script>

    <script src='../../include/dhtmlxDataProcessor/codebase/dhtmlxdataprocessor.js'></script>
    <!--<script src='../../include/dhtmlxdataprocessor/codebase/dhtmlxdataprocessor_debug.js'></script>-->

    <!-- dhtmlxCalendar -->
    <link rel="STYLESHEET" type="text/css" href="../../include/dhtmlxCalendar/codebase/dhtmlxcalendar.css">
    <script src='../../include/dhtmlxCalendar/codebase/dhtmlxcalendar.js'></script>
    <script src='../../include/dhtmlxCalendar/codebase/dhtmlxcommon.js'></script>
    <script>window.dhx_globalImgPath = "'../../include/dhtmlxCalendar/codebase/imgs/";</script>



    <!-- dhtmlxCombo -->
    <!--    <link rel="STYLESHEET" type="text/css" href="../../include/dhtmlxCombo/codebase/dhtmlxcombo.css">-->
    <!--    <script>//window.dhx_globalImgPath="../../include/dhtmlxCombo/codebase/imgs/";</script>-->
    <!--    <script src="../../include/dhtmlxCombo/codebase/dhtmlxcommon.js"></script>-->
    <!--    <script src="../../include/dhtmlxCombo/codebase/dhtmlxcombo.js"></script>-->


    <script src='../../include/dhtmlxConnector_php/codebase/connector.js'></script>



    <!--=========================================================================
                            Extjs Source
    =============================================================================-->
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/resources/css/ext-all.css" />
    <!-- GC -->
    <!-- LIBS -->
    <script type="text/javascript" src="../../include/Extjs/adapter/ext/ext-base.js"></script>
    <!-- ENDLIBS -->
    <script type="text/javascript" src="../../include/Extjs/ext-all.js"></script>
    <script type="text/javascript" src="progress-bar.js"></script>
    <link rel="stylesheet" type="text/css" href="progress-bar.css" />
    <script language="javascript" src="../../include/Extjs/ux/Spotlight.js"></script>

    <!-- Common Styles for the examples -->
<!--    <link rel="stylesheet" type="text/css" href="examples.css" />-->
<!--    <script type="text/javascript" src="examples.js"></script>-->
    <!--=========================================================================
                           End of Extjs Source
    =============================================================================-->

    <link rel="stylesheet" href="../../css/themes/default/default.css" type="text/css">
    <script language="javascript" src="../../js/hilitebu.js"></script>                          <!-- New Grid Editor-->
    <script language="JavaScript" src="../../js/cross.js"></script>
    <script language="JavaScript" src="../../js/tooltips.js"></script>
    <?php
}

function ExtIncludes() {
    ?>
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/resources/css/ext-all.css">
    <!--        <link rel="stylesheet" type="text/css" href="xml-tree-loader.css" />-->
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/ux/gridfilters/css/GridFilters.css" />
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/ux/gridfilters/css/RangeMenu.css" />
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/ux/css/Portal.css" />




    <script type="text/javascript" src="../../include/Extjs/adapter/yui/ext-yui-adapter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/adapter/ext/ext-base.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ext-all-debug.js"></script>


    <script type="text/javascript" src="../../include/Extjs/ux/XmlTreeLoader.js"></script>

    <script type="text/javascript" src="../../include/Extjs/ux/CheckColumn.js"></script>
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/ux/css/RowEditor.css" />
    <script type="text/javascript" src="../../include/Extjs/ux/RowEditor.js"></script>

    <link rel="stylesheet" type="text/css" href="../../include/Extjs/shared/examples.css" />
    <link rel="stylesheet" type="text/css" href="../../include/Extjs/shared/icons/silk.css" />
    <script type="text/javascript" src="../../include/Extjs/shared/examples.js"></script>
    <!-- Extensions - Paging Toolbar -->
    <script type="text/javascript" src="../../include/Extjs/ux/paging/pPageSize.js"></script>
    <!-- Extensions - Filtering -->
    <script type="text/javascript" src="../../include/Extjs/ux/menu/EditableItem.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/menu/RangeMenu.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/gridfilters/menu/ListMenu.js"></script>

    <script type="text/javascript" src="../../include/Extjs/ux/grid/GridFilters.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/Filter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/StringFilter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/DateFilter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/ListFilter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/NumericFilter.js"></script>
    <script type="text/javascript" src="../../include/Extjs/ux/grid/filter/BooleanFilter.js"></script>

    <script type="text/javascript" src="../../include/Extjs/printer/Printer-all.js"></script>
    <script type="text/javascript" src="../../include/Extjs/printer/renderers/Base.js"></script>
    <script type="text/javascript" src="../../include/Extjs/export/Exporter-all.js"></script>

    <?php
}

function Ext4Includes() {
    ?>
    <link rel="stylesheet" type="text/css" href="../../include/Ext4/resources/css/ext-all.css" />
    <script type="text/javascript" src="../../include/Ext4/shared/examples.css"></script>
    <script type="text/javascript" src="../../include/Ext4/bootstrap.js"></script>
    <?php
}
?>
<script language="JavaScript">
    function IsNumeric(strString) //  check for valid numeric strings
    {
        if(!/\D/.test(strString)) return true;//IF NUMBER
        else if(/^\d+\.\d+$/.test(strString)) return true;//IF A DECIMAL NUMBER HAVING AN INTEGER ON EITHER SIDE OF THE DOT(.)
        else return false;
    }

    function chkOrderform(d) {
        var amnt=sgrid.cells(sgrid.getSelectedId(),4).getValue();
        if(d.ordIrnNo.value==""){
            alert("Ensure you select The Order Type");
            d.ordIrnNo.focus();
            return false;
        }else if(d.supStoredesc.value==""){
            alert("Please Select the Supplying Store");
            d.supStoredesc.focus();
            return false;
        }else if(d.storeDesc.value==""){
            alert("Please Select the Ordering Department");
            d.storeDesc.focus();
            return false;
        }else if(sgrid.getRowsNum()<0){
            alert("Please Enter the items to Order");
            return false;
        }else if(amnt=='' && amnt<1){
            alert("Invalid order quantity, Enter the Right Quantity");
            return false;
        }
    }
</script>

<?php

function displayItems($db) {
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody>
    <tr>
        <td  valign="top" align="middle" height="35">
                 <table cellspacing="0"  class="titlebar" border=0>
                         <tr valign=top  class="titlebar" >
                          <td bgcolor="#99ccff" >
                            &nbsp;&nbsp;<font color="#330066">Pharmacy Order</font>

                               </td>
                          <td bgcolor="#99ccff" align=right><a
                           href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
                           href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
                           href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
                         </tr>
                  </table>';
    // echo "<form name=\"order\" method=\"POST\" action=". $_SERVER['PHP_SELF'] . ">";

    echo '<table border="0" width="70%">
                <tbody>
                    <tr>
                        <td> <input type="submit" value="Update Prices" name="btn1" id="btn1" /></td>
                    </tr>
                    <tr>
                        <td> <div id="gridbox" height="400px" style="background-color:white;"></div></td>
                        
                    </tr>
                    <tr><td>
                            <div class="status" id="p1text">Nothing to see here.</div>
                            <div id="p1" style="width:300px;"></div>
                     </td></tr>
                    
                    <tr><td colspan="4" align="left">
                            </td>


                    </tr>
                </tbody>
            </table>';
//</form>';

    require_once 'gridfiles_6.php';
}

function displayOrderForm($db) {
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Pharmacy Orders</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table>';
    echo "<form name=\"order\" method=\"POST\" action=" . $_SERVER['PHP_SELF'] . " onSubmit='return chkOrderform(this)'>";

    echo '<table border="0" width="70%">
                <tbody>
                    <tr>
                        <td>Order Type</td>
                        <td colspan="3"><input type="radio"  id="orderType" name="orderType" value="Transfere" onclick="getNextIrnNo(this.value)"/>Transfere:
                        <input type="radio" id="orderType" name="orderType" value="Consumption" onclick="getNextIrnNo(this.value)"/>Consumption</td>
                    </tr>
                    <tr>
                        <td>Date</td>
                        <td><input type="text" name="ordDate" value="' . $req_date = date("Y-m-d") . '" /></td>
                        <td>Requision No:</td>
                        <td><input type="text" name="ordIrnNo" value="" onblur="getNextIrnNo(this.value)"/></td>
                    </tr>
                    <tr>
                        <td>Ordering Store/Department</td>
                        <td colspan="3"><select name="storeID" id="storeID" onchange="getStore(this.value)">
                                        <option>Select Store</option>';
    $sql = 'select st_id,`st_name` from care_ke_stlocation order by st_name asc';
    $result = $db->Execute($sql);
    while ($row = $result->FetchRow()) {
        echo '<option value=' . $row[0] . '>' . $row[1] . '</option>';
    }
    echo '</select>
                        <input type="text" id="storeDesc" name="storeDesc" value="" /></td>
                    </tr>
                    <tr>
                        <td>Status</td>
                        <td><input type="radio" id="status" name="status" value="" />Regular:
                        <input type="radio" id="status" name="status" value="" />Consumption:
                        <input type="radio" id="status" name="status" value="" />Emergency:</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Supplying Store</td>
                        <td colspan="3"><select name="supStoreid" id="supStoreid" onchange="getStore2(this.value)">
                                        <option>Select Store</option>';
    $sql = "select st_id from care_ke_stlocation where store=1 and mainStore=1";
    $result = $db->Execute($sql);
    while ($row = $result->FetchRow()) {
        echo '<option value=' . $row[0] . '>' . $row[0] . '</option>';
    }
    echo '</select>
                            <input type="text" id="supStoredesc" name="supStoredesc" value="" /></td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div id="gridbox" height="200px" style="background-color:white;"></div>
                        </td>

                    </tr>
                    <tr>
                        <td>Total Items Ordered</td>
                        <td><input type="text" id="totalOrders" name="totalOrders" value="" />
							<input type="hidden" id="myform_key" name="myform_key" value="'.  md5(date('Y:m:d H:i:s')) .'" /></td>
                        <td colspan="2" align="right">
                            <input type="submit" id="submit" name="submit" value="Send" />


                         </td>
                    </tr>

                    <tr><td colspan="4" align="left"><input type="text" name="myform_key" value="'. md5(date('Y:m:d H:i:s')).'" />
                            </td>


                    </tr>
                </tbody>
            </table>
</form>';
    echo '<button onclick=addRows(1)>Add Row</button>
         <button onclick=deleteRow()>Delete</button>
         <button onclick=initPSearch()>Get Products List</button>';
    require_once 'gridfiles.php';
}

function displayOrderCountForm($db) {
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Pharmacy/Buffer Stock Counts</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table>';
    echo"<form enctype='multipart/form-data' action='importCount.php' method='post'>
                <input type='hidden' name='MAX_FILE_SIZE' value='2000000' />
                <table width='600'>
                <tr>
                    <td>Import Stock Count from Excel:</td>
                    <td><input type='file' name='file' if='file' /></td>
                    <td><input type='submit' value='Upload' /></td>
                </tr>
                </table>
         ";
    echo '</HR>';
    echo "<form name=\"order\" method=\"POST\" action=" . $_SERVER['PHP_SELF'] . ">";

    echo '<table border="0" width="70%">
                <tbody>
                <tr><td>
                   
                    </td>
                </tr>
                    
                    <tr>
                        <td>Date</td>
                        <td id="datefield"></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Store </td>
                        <td colspan="3"><select name="storeID" id="storeID" onchange="applyCountFilter()">
                                        <option>Select Store</option>';
    $sql = 'select st_id,`st_name` from care_ke_stlocation where store in (1)';
    $result = $db->Execute($sql);
    while ($row = $result->FetchRow()) {
        echo '<option value=' . $row[0] . '>' . $row[1] . '</option>';
    }
    echo '</select>
                        <input type="text" id="storeDesc" name="storeDesc" value="" /></td>
                    </tr>
                     <tr>
                        <td colspan="4">
                            <div id="gridbox" height="200px" style="background-color:white;"></div>
                            <div id="hello-win" align="center"></div>   
                        </td>

                    </tr>
                     <tr>
                        <td>Total Items Counted</td>
                        <td><input type="text" id="totalOrders" name="totalOrders" value="" /></td>
                        <td colspan="2" align="right">
                            <input type="submit" id="submit" name="submit" value="Send" />


                         </td>
                    </tr>
                </tbody>
            </table>
</form></form>';
    echo '<button onclick=saveCount()>Export Counts</button>
           <button onclick=addRows(1)>Add Row</button>
           <button onclick=deleteRow()>Delete</button>
           <button onclick=initDrugsSearch()>Get Products List</button>
           <button  id="clearImports" onclick=clearImports()>Clear Imported and Restart Import</button>';
    require_once 'gridfiles2.php';
}

function displayServiceOrderForm($db) {
    $input_user = $_SESSION['sess_login_username'];
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Service Orders</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table>
 <table border="0" width="80%">
        <tbody>
            <tr>
                <td>';
    $sql1 = "SELECT default_Stores FROM care_users WHERE `name`='$input_user'";
    //                      echo $sql1;
    $result = $db->Execute($sql1);
    $row = $result->FetchRow();
    $defaultStore = $row[0];
    $sql = "SELECT st_id,st_name FROM care_ke_stlocation WHERE store=1  AND MainStore=1 AND 
st_id IN(SELECT st_id FROM care_ke_storeusers s LEFT JOIN care_users u ON s.`Username`=u.`login_id` WHERE u.`name`='$input_user'
 AND serviceDrugs='Yes')" ;
    
    $result = $db->Execute($sql);
    echo "Select Supplying Store:<select id='suppStore' onChange='getsOrder(this.value)'>";
    echo "<option>Select Supplying Store</option>";
    while ($row = $result->FetchRow()) {
        echo "<option value='$row[0]'>$row[1]</option>";
    }
    echo "</select>";
    echo '</td>

            </tr>
            <tr>
                <td>
                <div id="gridbox2" height="100px" style="background-color:white;"></div>
                </td>

            </tr>
</td></tr></tbody></table><br>';

    echo '<form name="serviceOrder" method="POST" action="' . $_SERVER['PHP_SELF'] . '">
                            <table width=80%>
                                <tr>
                                    <td>Requsition Date</td>
                                    <td><input type="text" id="ordDate" name="ordDate" value="" /></td>
                                    <td></td>
                                    <td>Requision No:</td>
                                    <td><input type="text" id="ordIrnNo" name="ordIrnNo" value="" onblur="getOrderedItems()"/></td>
                                </tr>
                                <tr>
                                    <td>Ordering Store</td>
                                    <td colspan="2"><input type="text" id="storeID" name="storeID" value="" />
                                                    <input type="text" id="storeDesc" name="storeDesc" value="" /></td>
                                     <td>Issiue No:</td>
                                     <td><input type="text" id="issiuNo" name="issiuNo" value="" /></td>
                                </tr>
                                <tr>
                                    <td>Status</td>
                                    <td><input type="text" id="status" name="status" value="" /></td>
                                    <td></td>
                                    <td>Issue type</td>
                                    <td><input type="text" id="issue" name="issue Type" value="" /></td>
                                </tr>
                                <tr>
                                    <td>Supplying Store</td>
                                    <td colspan="2"><input type="text" id="supStoreid" name="supStoreid" value="" />
                                        <input type="text" id="supStoredesc" name="supStoredesc" value="" /></td>
                                    <td>Issue Date</td>
                                    <td><input type="text" id="issue" name="issue Date" value="' . date("Y-m-d") . '" /></td>
                                </tr>
                                <tr>
                                    <td colspan="5">
                                        <div id="gridbox" height="200px" style="background-color:white;"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Total Items Ordered</td>
                                    <td><input type="text" id="totalOrders" name="totalOrders" value="" />
                                        <input type="text" id="myform_key" name="myform_key" value="'.  md5(date('Y:m:d H:i:s')) .'" />
                                    </td>
                                    <td colspan="3" align="right">
                                   
                                       &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;<input type="submit" id="submit" name="submit" value="Send" />
                                     </td>
                                </tr>
                         </table>
                </form>';

    echo '<button onclick=addRows(1)>Add Row</button>
         <button onclick=deleteRow()>Delete</button>
         <button onclick=initPSearch()>Get Products List</button> 
         <button onclick=cancelOrder(document.getElementById("ordIrnNo").value)>Cancel Order</button>';
    require_once 'gridfiles_1.php';
}

function displayLevelsForm($db) {
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Stock Levels</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table> <table border="1" width=100%>
   
    <tbody>
    <tr>
    <td>Stock Levels</td>
    </tr>
    <tr>
    <td><div id="gridbox" height="500px" style="background-color:white;"></div></td>
    </tr>
    </tbody>
    </table>';


    require_once 'gridfiles_2.php';
}

function displayIssueDrugsForm($db) { ?>
    <table width=100% border=1 cellspacing=0 height=100%>
        <tbody>
            <tr>
                <td  valign="top" align="middle" height="35">
                     <table cellspacing="0"  class="titlebar" border=0>
                             <tr valign=top  class="titlebar" >
                                 <td bgcolor="#99ccff" >&nbsp;<font color="#330066">Issue Drugs</font></td>
                                 <td bgcolor="#99ccff" align=right>
                                     <a href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif"
                                                                                     border=0 width="110" height="24" alt=""
                                                                        style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a>
                                     <a href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")">
                                                   <img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt=""
                                                     style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>
                                     <a href="../../modules/news/start_page.php?ntid=false&lang=$lang" >
                                                  <img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt=""
                                                  style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a> </td>
                             </tr>
                     </table>
                    <form name="order" method="POST" action="<?php echo $_SERVER['PHP_SELF'] ?>"  onSubmit="return chkform(this)">
                <table width=80% border=0>
                    <tr>
                        <td>Type:</td>
                        <td><input type="radio" id="issType" name="issType" value="2" onclick="getNextIssNo(this.value)" checked/>:OutPatient
                            <input type="radio" id="issType" name="issType" value="1" onclick="getNextIssNo(this.value)" />:InPatient
                            <input type="radio" id="issType" name="issType" value="Cash" onclick="getNextIssNo(this.value)" />:Cash Sale</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Date</td>
                        <td><input type="text" id="issDate" name="issDate" value="<?php echo $req_date = date("Y-m-d"); ?>" />
                            Issue No:<input type="text" id="issNo" name="issNo" readonly value="" /></td>
                        <td>Cash Receipt:</td>
                        <td><input type="text" id="receiptNo" name="receiptNo" readonly value="" /></td>
                    </tr>
                    <tr>
                        <td>Patient No</td>
                        <td><input type="text" id="pid" name="pid" value="" ondblclick="initPtsearch()" onblur="getPnames(this.value)"/>
                            <input type="text" id="pname" name="pname" value="" size="30" onclick="getOrders()" onblur="getDrugTotals(6);"/>
                            <input type="text" id="enc_no" name="enc_no" readonly value="" size="10" />
                            <img src="gui/edit_pricesettings_files/en_downarrow.png" width="12" height="12" alt="en_downarrow" onclick="getOrders()"/>
                            <button id='history' onclick="getPrescriptionHistory()">Prescription History</button>
                        </td>
                         <td width=120px>Receipt Amount:</td>
                         <td><input type="text" id="receiptAmount" name="receiptAmount" value="" /></td>
                    </tr>
                    <tr>
                        <td>Doctor</td>
                        <td><input type="text" id="docName" name="docName" value="" size="30" readonly ondblclick="getDoc()"/>
                            <input type="text" id="numRows" name="numRows" readonly></td>
                        <td>Age</td>
                        <td><input type="text" id="age" name="age" value="" size="20"/></td>
                    </tr>
                    <tr>
                        <td>Store</td>
                        <td><select name="storeID" id="storeID" onchange="getStore3(this.value)">
                                        <option></option>';
                                       <?php  
                                        $input_user = $_SESSION['sess_login_username'];
                                       $sql = "SELECT st_id,st_name FROM care_ke_stlocation WHERE store=1  AND Dispensing=1 AND 
                            st_id IN(SELECT st_id FROM care_ke_storeusers s LEFT JOIN care_users u ON s.`Username`=u.`login_id` WHERE u.`name`='$input_user' AND issueDrugs='Yes')";
                                        $result = $db->Execute($sql);
                                        while ($row = $result->FetchRow()) {
                                            echo '<option value=' . $row[0] . '>' . $row[1] . '</option>';
                                        } ?>
                            </select>
                            <input type="text" id="supStoredesc" name="supStoredesc" value="" size="30"/></td>
                        <td>Payment Method:</td>
                        <td><div id="paymode" class="pay_default"></div><input type="hidden" id="pmode" name="pmode" value=""/>
                            <div id="message" class="blinkError"></div></td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div id="gridbox" height="300px" style="background-color:white;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>Total Cost</td>
                        <td><input type="text" id="totalCost" name="totalCost" value="" onclick="getDrugTotals(7)"/></td>
                        <td colspan="2" align="right">
                            <input type="submit" id="update" name="submit" value="Update" style="width:120px; height:30px;" />
                            <input type="submit" id="submit" name="submit" value="Send"  style="width:120px; height:30px;" />
                            <input type="hidden" id="myform_key" name="myform_key" value="<?php echo md5(date('Y:m:d H:i:s')) ?>" />
                         </td>
                    </tr>
             </table>
    </form>

    <button onclick=deleteRow()>Cancel Prescription</button>
    <button onclick=printPrescriptions()>Print Prescriptions</button>
<!--    <button onclick=updateBillItems()>Update Bill Items</button>-->
<!--      <button onclick=deleteRow()>Delete</button>-->
<!--     <button onclick=initPSearch()>Get Products List</button>';-->

    <?php require_once 'gridfiles_4.php';
}

function displayAdjustStockForm($db) {
    $lang_tables[] = 'pharmacy.php';
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Stock Adjustment</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table>
       <form name="order" method="POST" action="' . $_SERVER['PHP_SELF'] . '">
                <table width=80% border=0> 
                    <tr>
                        <td>Adjustment No</td>
                        <td><input type="text" id="adjNO" name="adjNO" value="" />
                            Description:<input type="text" id="adjDesc" name="AdjDesc" value="" />
                            Date<input type="text" id="adjDate" name="adjDate" value="' . $req_date = date("Y-m-d") . '"/></td>
                         <td></td>
                    </tr>
                    <tr>
                        <td>Store</td>
                        <td><select id="storeID"  name="storeID" onchange="getStore3(this.value)">
                                        <option>Select Store</option>';
    $sql = 'select st_id from care_ke_stlocation';
    $result = $db->Execute($sql);
    while ($row = $result->FetchRow()) {
        echo '<option value=' . $row[0] . '>' . $row[0] . '</option>';
    }
    echo '</select>
                            <input type="text" id="supStoredesc" name="supStoredesc" value="" size="40"/></td>
                        <td></td>
                        
                    </tr>
                    <tr>
                        <td colspan="3">
                            <div id="gridbox" height="150px" style="background-color:white;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>Total Cost</td>
                        <td><input type="text" id="totalCost" name="totalCost" value="" /></td>
                        <td colspan="2" align="right">
                            <input type="submit" id="submit" name="submit" value="Send" />
                         </td>
                    </tr>
             </table>
    </form>';
    echo '<button onclick=addRows(1)>Add Row</button>
         <button onclick=deleteRow()>Delete</button>
         <button onclick=initPSearch()>Get Products List</button>';
    require_once 'gridfiles_4.php';
}

function displayrReturnsForm($db) {
    echo '<table width=100% border=0 cellspacing=0 height=100%>
<tbody class="main">
	<tr>
		<td  valign="top" align="middle" height="35">
			 <table cellspacing="0"  class="titlebar" border=0>
 <tr valign=top  class="titlebar" >
  <td bgcolor="#99ccff" >
    &nbsp;&nbsp;<font color="#330066">Returns from Patients</font>

       </td>
  <td bgcolor="#99ccff" align=right><a
   href="javascript:window.history.back()"><img src="../../gui/img/control/default/en/en_back2.gif" border=0 width="110" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)" ></a><a
   href="javascript:gethelp("pharmacy_menu.php","Pharmacy :: Main Menu")"><img src="../../gui/img/control/default/en/en_hilfe-r.gif" border=0 width="75" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a><a
   href="../../modules/news/start_page.php?ntid=false&lang=$lang" ><img src="../../gui/img/control/default/en/en_close2.gif" border=0 width="103" height="24" alt="" style="filter:alpha(opacity=70)" onMouseover="hilite(this,1)" onMouseOut="hilite(this,0)"></a>  </td>
 </tr>
 </table>
  <form name="order" method="POST" action="' . $_SERVER['PHP_SELF'] . '">
                <table width=80% border=0>
                    <tr>
                        <td>Type:</td>
                        <td><input type="radio" name="issType" value="OP" onclick="getNextReturnNo()"/>OutPatient:
                            <input type="radio" name="issType" value="IP" onclick="getNextReturnNo()"/>InPatient:
                            <input type="radio" name="issType" value="Cash" onclick="getNextReturnNo()"/>Cash Sale:</td>
                        <td>Slip No</td>
                        <td><input type="text" id="SlipNO" name="SlipNO" value="" size="30" /></td>
                    </tr>
                    <tr>
                        <td>Date</td>
                        <td><input type="text" id="issDate" name="issDate" value="'. date("Y-m-d") .'" onblur="getNextReturnNo()"/>
                            Order No:<input type="text" id="order_no" name="order_no" value=""/></td>
                        <td>Prescriprion No</td>
                        <td><input type="text" id="prescNO" name="prescNO" value="" size="30" 
                        ondblclick="showPrescriptions(document.order.issDate.value,document.order.patientId.value)"/></td>
                    </tr>
                    <tr>
                        <td>Patient No</td>
                        <td><input type="text" id="patientId" name="patientId" value="" onblur="getPnames(this.value)" ondblclick="initPsearch()"/>
                            <input type="text" id="pname" name="pname" value="" size="30"/></td>
                         <td></td>
                         <td></td>
                    </tr>
                <tr>
                        <td>Store(Loc)</td>
                        <td><select name="storeID" id="storeID" onchange="getStore2(this.value)">
                                        <option>Select Store</option>';
    $sql = 'select st_id from care_ke_stlocation where Dispensing=1';
    $result = $db->Execute($sql);
    while ($row = $result->FetchRow()) {
        echo '<option value=' . $row[0] . '>' . $row[0] . '</option>';
    }
    echo '</select>
                            <input type="text" id="supStoredesc" name="supStoredesc" value="" /></td>
                         <td></td>
                         <td></td>
                    </tr>
                    <tr>
                        <td colspan="4">
                            <div id="gridbox" height="150px" style="background-color:white;"></div>
                        </td>
                    </tr>
                    <tr>
                        <td>Total Cost</td>
                        <td><input type="text" id="totalCost" name="totalCost" value="" /></td>
                        <td colspan="2" align="right">
                            <input type="submit" id="submit" name="submit" value="Send" />
                         </td>
                    </tr>
             </table>
    </form>';
//    echo '<button onclick=addRows(1)>Add Row</button>
        echo '<button onclick=deleteRow()>Delete</button>';
////         <button onclick=initPSearch()>Get Products List</button>';
    require_once 'gridfiles_5.php';
}
?>

<script>
    function clearImports(str) {
        xmlhttp = GetXmlHttpObject();
        if (xmlhttp == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc8=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=clearImports";
        xmlhttp.onreadystatechange = stateDeleteImports;
        xmlhttp.open("POST", url, true);
        xmlhttp.send(null);
    }

    function stateDeleteImports()
    {
        //get payment description
        if (xmlhttp.readyState == 4)
        {
            var str = xmlhttp.responseText;
            if (str == 1) {
                alert("Imported data has been cleared, you can begin importing");
            }

        }
    }



    function getPrescriptionNo(str) {
        xmlhttp = GetXmlHttpObject();
        if (xmlhttp == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc8=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=Cancel";
        xmlhttp.onreadystatechange = stateChanged9;
        xmlhttp.open("POST", url, true);
        xmlhttp.send(null);
    }


    function stateChanged9()
    {
        //get payment description
        if (xmlhttp.readyState == 4)
        {
            var str = xmlhttp.responseText;
            //str2=str.search(/,/)+1;
            alert(str);
        }
    }

    function cancelOrder(str) {
        xmlhttp = GetXmlHttpObject();
        if (xmlhttp == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc8=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=Cancel";
        xmlhttp.onreadystatechange = stateChanged8;
        xmlhttp.open("POST", url, true);
        xmlhttp.send(null);
    }

    function stateChanged8()
    {
        //get payment description
        if (xmlhttp.readyState == 4)
        {
            var str = xmlhttp.responseText;
            //str2=str.search(/,/)+1;
            alert(str);
        }
    }

    function getStore(str) {
        xmlhttp = GetXmlHttpObject();
        if (xmlhttp == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=service";
        xmlhttp.onreadystatechange = stateChanged;
        xmlhttp.open("POST", url, true);
        xmlhttp.send(null);
    }

    function stateChanged()
    {
        //get payment description
        if (xmlhttp.readyState == 4)
        {
            var str = xmlhttp.responseText;
            //str2=str.search(/,/)+1;
            document.order.storeDesc.value = str;
        }
    }

    function getNextIrnNo(str) {
        xmlhttp2 = GetXmlHttpObject();
        if (xmlhttp2 == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc2=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=irnNo";
        xmlhttp2.onreadystatechange = stateChanged2;
        xmlhttp2.open("POST", url, true);
        xmlhttp2.send(null);
    }

    function stateChanged2()
    {
        //get payment description
        if (xmlhttp2.readyState == 4)
        {
            var str = xmlhttp2.responseText;
            //str2=str.search(/,/)+1;
            document.order.ordIrnNo.value = str;
        }
    }


    function getStore2(str) {
        xmlhttp3 = GetXmlHttpObject();
        if (xmlhttp3 == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc3=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=supSto";
        xmlhttp3.onreadystatechange = stateChanged3;
        xmlhttp3.open("POST", url, true);
        xmlhttp3.send(null);
    }

    function stateChanged3()
    {
        //get payment description
        if (xmlhttp3.readyState == 4)
        {
            var str = xmlhttp3.responseText;
            //str2=str.search(/,/)+1;
            document.order.supStoredesc.value = str;
        }
    }


    function getNextIssNo(str) {
        xmlhttp5 = GetXmlHttpObject();
        if (xmlhttp5 == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc5=" + str;
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=issNo";
        xmlhttp5.onreadystatechange = stateChanged5;
        xmlhttp5.open("POST", url, true);
        xmlhttp5.send(null);
    }

    function stateChanged5()
    {
        //get payment description
        if (xmlhttp5.readyState == 4)
        {
            var str = xmlhttp5.responseText;
            //str2=str.search(/,/)+1;
            document.order.issNo.value = str;
        }
    }


    function getNextReturnNo() {
        xmlhttp5 = GetXmlHttpObject();
        if (xmlhttp5 == null)
        {
            alert("Browser does not support HTTP Request");
            return;
        }
        var url = "pharmVals.php?desc10=desc10";
        url = url + "&sid=" + Math.random();
        url = url + "&callerID=returnNo";
        xmlhttp5.onreadystatechange = stateChanged10;
        xmlhttp5.open("POST", url, true);
        xmlhttp5.send(null);
    }

    function stateChanged10()
    {
        //get payment description
        if (xmlhttp5.readyState == 4)
        {
            var str = xmlhttp5.responseText;
            //str2=str.search(/,/)+1;
            document.order.order_no.value = str;
        }
    }


    function GetXmlHttpObject()
    {
        if (window.XMLHttpRequest)
        {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            return new XMLHttpRequest();
        }
        if (window.ActiveXObject)
        {
            // code for IE6, IE5
            return new ActiveXObject("Microsoft.XMLHTTP");
        }
        return null;
    }

    function gethelp(x, s, x1, x2, x3, x4)
    {
        if (!x)
            x = "";
        urlholder = "../../main/help-router.php?sid=<?php echo $sid; ?>&lang=en&helpidx=" + x + "&src=" + s + "&x1=" + x1 + "&x2=" + x2 + "&x3=" + x3 + "&x4=" + x4;
        helpwin = window.open(urlholder, "helpwin", "width=790,height=540,menubar=no,resizable=yes,scrollbars=yes");
        window.helpwin.moveTo(0, 0);
    }

    function printOut()
    {
        urlholder = "<?php echo $root_path; ?>modules/registration_admission/show_prescription.php?externalcall=TRUE&printout=TRUE&pn=<?php echo $pn; ?>";
        testprintout = window.open(urlholder, "printout", "width=800,height=600,menubar=no,resizable=yes,scrollbars=yes");

    }

    function printPrescriptions() {
        var pid = document.getElementById('pid').value;
        var encounterNr=document.getElementById('enc_no').value;
        var radios = document.getElementsByName('issType');

        for (var i = 0; i < radios.length; i++) {
            if (radios[i].checked) {
                var isstypes = radios[i].value;
            }
        }

//     alert('Selected item '+isstypes+' and Pid '+pid);

        window.open('prescription_pdf.php?pid=' + pid + '&issType=' + isstypes+'&encNo='+encounterNr
                , "Precription",
                "menubar=no,toolbar=no,width=300,height=550,location=yes,resizable=no,scrollbars=no,status=yes");
    }
    // -->
</script>
