/*
 * File: app/view/WardOccupancyViewController1.js
 *
 * This file was generated by Sencha Architect version 4.2.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.2.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.2.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('CarePortal.view.WardOccupancyViewController1', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.assignbeds',

    onWardsItemClick: function(item) {
        var view = this.getView();
        var wardsMenu = this.lookupReference('wardsButton').menu;

        //Ext.Msg.alert('Test',item.value);

        view.store.load({
            params:{
                wardId:item.value
            }
        });

        var d = new Date();
        this.lookupReference('wardTitle').setValue(item.text + "("+ d.toLocaleString() +")");

        this.getWaitingList(item.value);

    },

    getWaitingList: function(wrdNr) {
        //vitalsPanel = Ext.create('CarePortal.view.Vitals', {});
        //waitingListPanel=this.getWardoccupancy().down("#waitingList");
        waitingListPanel=this.lookupReference('waitingList');


        var waitingStore=Ext.data.StoreManager.lookup("WaitingListStore");

        waitingStore.load({
            params: {
                wardNo:wrdNr
            },
            callback: function(records, operation, success) {
                    var tpl=new Ext.XTemplate(
                        '<tpl for=".">',
                            '<li style="border:1px solid #1faf2e; border-radius: 5px;cursor: pointer;list-style: none outside;color:white; padding:5px;background-color:#1faf2e; margin:3px;" id={Pid}>{Pid} {Names}</li>',
                        '</tpl>'
                    );
                var data = [];

                waitingStore.each(function(record) {
                    data.push(record.getData());


                });

                tpl.overwrite(waitingListPanel.body,data);
            },
            scope: this
        });

    },

    onWardsListLoad: function(store, records, successful, operation, eOpts) {
        //Ext.Msg.alert('Test','Test');
        var me = this,
            references = me.getReferences(),
            view = me.getView(),
            items = [],
            columns = [ view.nameColumn ];


        // iterate each record in the store
        store.each(function (metaRecord) {
            items.push(Ext.apply({
                text  : metaRecord.data.Name,
                value : metaRecord.data.Nr,
                listeners : {
                    click : me.onWardsItemClick,
                    scope : me
                }
            }));

        });
        references.wardsButton.menu.add(items);

    }

});
